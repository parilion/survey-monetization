# 测试指南

本文档提供完整的系统测试步骤，帮助你验证所有功能是否正常工作。

## 📋 测试前准备

### 1. 确认环境已启动

```bash
# 检查MySQL是否运行
mysql -u root -p
# 输入密码后，执行：
SHOW DATABASES;
# 应该能看到 redbook_survey 数据库

# 检查后端服务
# 访问 http://localhost:3000/api
# 应该能看到 "Cannot GET /api" 或类似提示

# 检查H5前端
# 访问 http://localhost:5173
# 应该能看到密码验证页面

# 检查管理后台
# 访问 http://localhost:5174
# 应该能看到登录页面
```

### 2. 准备测试数据

建议准备以下测试内容：
- 1个问卷（如：你是哪种香水性格？）
- 30道题目
- 4-6个结果模板
- 10个测试密码

## 🧪 完整测试流程

### 阶段1：管理后台基础功能测试

#### 1.1 登录功能测试

**测试步骤：**
1. 访问 http://localhost:5174
2. 输入用户名：`admin`
3. 输入密码：`admin123`
4. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功，跳转到数据概览页
- ✅ 顶部显示用户名"超级管理员"
- ✅ 左侧显示完整的导航菜单

**常见问题：**
- 如果无法登录，检查用户名密码是否正确
- 如果报错，打开浏览器控制台查看错误信息

#### 1.2 问卷管理测试

**测试步骤：**
1. 点击左侧菜单"问卷管理"
2. 点击"新建问卷"按钮
3. 填写表单：
   - 问卷标题：`你是哪种香水性格？`
   - 问卷描述：`通过30道题目，测试你的独特香水性格`
   - 引导文案：`香水是灵魂的隐形外衣。通过 30 道深度心理潜意识测试，寻找那款真正属于你灵魂底色的本命香氛。`
   - 状态：选择"启用"
4. 点击"确定"

**预期结果：**
- ✅ 提示"创建成功"
- ✅ 问卷列表显示新创建的问卷
- ✅ 问卷状态显示为"启用"

**测试编辑功能：**
1. 点击问卷的"编辑"按钮
2. 修改问卷标题
3. 点击"确定"
4. ✅ 提示"更新成功"，列表中标题已更新

#### 1.3 题目管理测试

**测试步骤：**
1. 点击左侧菜单"题目管理"
2. 在顶部下拉框选择刚才创建的问卷
3. 点击"新建题目"按钮
4. 填写第一道题：
   - 题目内容：`你最喜欢的花是？`
   - 排序序号：`1`
   - 题目类型：单选
   - 添加4个选项：
     - 选项1：`向日葵` / 计分类型：`Citrus`
     - 选项2：`玫瑰或牡丹` / 计分类型：`Rose`
     - 选项3：`百合或兰花` / 计分类型：`Lavender`
     - 选项4：`干花或松枝` / 计分类型：`Woody`
5. 点击"确定"

**预期结果：**
- ✅ 提示"创建成功"
- ✅ 题目列表显示新题目
- ✅ 选项数量显示为4

**重复添加题目：**
- 按照相同方法添加至少5道题（用于测试）
- 生产环境需要添加完整的30道题

#### 1.4 结果模板测试

**测试步骤：**
1. 点击左侧菜单"结果模板"
2. 选择问卷
3. 点击"新建结果模板"
4. 填写结果模板1：
   - 结果类型：`Citrus`
   - 结果标题：`日光柑橘调`
   - 简短描述：`元气、少年感、直率、乐观`
   - 详细内容：`你的灵魂像一颗在阳光下爆开的柠檬，充满无限的生命力。你乐观、直接，讨厌拐弯抹角。你就像夏日的微风，无论走到哪里都能驱散阴霾。你的内心住着一个永远长不大的少年，对世界永远保持着好奇与热情。`
5. 点击"确定"

**预期结果：**
- ✅ 提示"创建成功"
- ✅ 列表显示新结果模板

**创建更多结果模板：**
- Rose（浪漫玫瑰调）
- Lavender（优雅薰衣草调）
- Woody（沉稳木质调）

建议至少创建4种结果类型。

#### 1.5 密码生成测试

**测试步骤：**
1. 点击左侧菜单"密码管理"
2. 点击"批量生成密码"按钮
3. 选择问卷
4. 生成数量：`10`
5. 点击"确定生成"

**预期结果：**
- ✅ 提示"成功生成 10 个密码"
- ✅ 列表显示10条密码记录
- ✅ 所有密码状态为"未使用"
- ✅ 过期时间为生成时间+12小时

**记录测试密码：**
- 复制其中一个密码（如：`ABC12345`）
- 用于后续H5端测试

### 阶段2：H5用户端功能测试

#### 2.1 密码验证测试

**测试步骤：**
1. 访问 http://localhost:5173
2. 在输入框中输入刚才复制的密码
3. 点击"访问页面"按钮

**预期结果：**
- ✅ 提示"验证成功"
- ✅ 自动跳转到测试引导页

**测试密码过期：**
- 在管理后台查看该密码，状态应变为"已使用"
- 再次使用同一密码验证，应提示"密码无效或已使用"

#### 2.2 测试引导页测试

**测试步骤：**
1. 查看页面显示的内容
2. 点击"开始寻香之旅"按钮

**预期结果：**
- ✅ 页面显示问卷标题："寻香·性格测试"
- ✅ 显示引导文案
- ✅ 显示题目总数
- ✅ 点击按钮后跳转到答题页

#### 2.3 答题功能测试

**测试步骤：**
1. 查看页面显示
2. 选择一个选项
3. 观察页面变化
4. 继续完成所有题目

**预期结果：**
- ✅ 顶部显示进度条
- ✅ 显示"Question 1/X"
- ✅ 显示题目内容
- ✅ 显示所有选项
- ✅ 选择选项后自动跳转下一题
- ✅ 进度条随答题进度更新
- ✅ 完成所有题目后自动提交

**测试进度保存：**
1. 答题到一半时刷新页面
2. ✅ 页面应恢复到之前的题目
3. ✅ 之前选择的答案应被保存
4. ✅ 可以继续答题

#### 2.4 结果展示测试

**测试步骤：**
1. 完成所有题目后查看结果页
2. 点击"重新测试"按钮

**预期结果：**
- ✅ 显示性格类型标题（如：日光柑橘调）
- ✅ 显示英文类型名（如：Citrus）
- ✅ 显示性格标签
- ✅ 显示详细的性格描述
- ✅ 点击"重新测试"后跳转回答题页，进度重置

### 阶段3：数据验证测试

#### 3.1 答题记录验证

**测试步骤：**
1. 在管理后台点击"答题记录"
2. 查看列表

**预期结果：**
- ✅ 显示刚才完成的测试记录
- ✅ 显示使用的密码
- ✅ 显示结果类型
- ✅ 显示得分
- ✅ 显示完成时间
- ✅ 显示用户IP

#### 3.2 密码状态验证

**测试步骤：**
1. 在管理后台点击"密码管理"
2. 找到使用过的密码
3. 查看状态

**预期结果：**
- ✅ 状态显示为"已使用"
- ✅ 显示使用时间
- ✅ 显示用户IP

### 阶段4：边界情况测试

#### 4.1 无效密码测试

**测试步骤：**
1. 在H5页面输入不存在的密码（如：`INVALID123`）
2. 点击"访问页面"

**预期结果：**
- ✅ 提示"密码无效或已使用"
- ✅ 不能进入系统

#### 4.2 重复使用密码测试

**测试步骤：**
1. 使用已经使用过的密码再次验证
2. 点击"访问页面"

**预期结果：**
- ✅ 提示"密码无效或已使用"
- ✅ 不能进入系统

#### 4.3 空数据测试

**测试步骤：**
1. 在管理后台删除所有题目
2. 在H5端使用新密码登录
3. 点击"开始寻香之旅"

**预期结果：**
- ✅ 提示"该问卷暂无题目，请联系客服"
- ✅ 不会进入答题页

## 🔍 性能测试

### 1. 页面加载速度

**测试步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到Network标签
3. 刷新H5页面
4. 查看加载时间

**预期结果：**
- ✅ H5首页加载时间 < 3秒
- ✅ 管理后台首页加载时间 < 3秒

### 2. API响应时间

**测试步骤：**
1. 在Network标签中查看API请求
2. 查看各个API的响应时间

**预期结果：**
- ✅ 密码验证API响应 < 500ms
- ✅ 获取题目API响应 < 500ms
- ✅ 提交答案API响应 < 1000ms

## 🐛 常见问题排查

### 问题1：后端API报错

**症状：** 前端提示网络错误或请求失败

**排查步骤：**
1. 确认后端服务是否运行：访问 http://localhost:3000/api
2. 检查浏览器控制台的错误信息
3. 检查后端控制台的错误日志
4. 确认数据库连接是否正常

### 问题2：密码验证失败

**症状：** 输入密码后提示无效

**排查步骤：**
1. 在管理后台检查密码是否存在
2. 检查密码状态（未使用/已使用/已过期）
3. 检查过期时间是否还在12小时内
4. 确认问卷是否启用

### 问题3：答题进度丢失

**症状：** 刷新后答题进度没有恢复

**排查步骤：**
1. 打开浏览器控制台
2. 查看Application → LocalStorage
3. 确认是否有 `survey_data` 键
4. 检查数据是否正确

### 问题4：结果计算错误

**症状：** 显示的结果类型不符合预期

**排查步骤：**
1. 检查题目选项的计分类型是否正确设置
2. 确认结果模板的类型名与计分类型一致
3. 查看答题记录中的得分分布

## ✅ 测试检查清单

完整测试后，确认以下功能都正常：

**管理后台：**
- [ ] 登录功能
- [ ] 问卷CRUD
- [ ] 题目CRUD
- [ ] 结果模板CRUD
- [ ] 密码批量生成
- [ ] 答题记录查看
- [ ] 数据筛选和分页

**H5用户端：**
- [ ] 密码验证
- [ ] 测试引导页
- [ ] 答题流程（30题）
- [ ] 进度保存
- [ ] 结果展示
- [ ] 重新测试

**数据完整性：**
- [ ] 密码状态正确更新
- [ ] 答题记录正确保存
- [ ] 结果计算准确
- [ ] 时间戳正确记录

**边界情况：**
- [ ] 无效密码处理
- [ ] 重复密码处理
- [ ] 空数据处理
- [ ] 网络错误处理

## 📝 测试报告模板

测试完成后，可以记录以下信息：

```
测试日期：2026-02-04
测试人员：[你的名字]
测试环境：开发环境

功能测试结果：
✅ 管理后台登录：通过
✅ 问卷管理：通过
✅ 题目管理：通过
✅ 结果模板：通过
✅ 密码管理：通过
✅ H5密码验证：通过
✅ H5答题流程：通过
✅ H5结果展示：通过
✅ 数据记录：通过

发现问题：
1. [描述问题]
2. [描述问题]

总体评价：
系统功能完整，可以投入使用。
```

---

**测试建议：**
- 建议在不同浏览器测试（Chrome、Safari、Firefox）
- 建议在移动设备测试H5页面（iOS、Android）
- 建议测试微信内置浏览器
- 建议进行压力测试（多人同时答题）

测试过程中如有问题，请查看主README.md的故障排除部分或联系开发人员。
